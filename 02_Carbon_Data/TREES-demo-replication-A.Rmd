---
title: "ART-TREES Data Replication Demo A"
subtitle: "Training exercise in version control and reproducible analyses"
author: "Murphy, S"
date: "2025-08-08"
output:
  github_document:
    toc: true
    toc_depth: 4
    df_print: kable

always_allow_html: TRUE
editor_options: 
  markdown: 
    wrap: 80
---

```{r setup-1}
#| warning: false
#| message: false
#| error: false
#| include: false
#| echo: false
easypackages::packages(
  "animation", "allodb", "BIOMASS", "c2z", "caret", "dataMaid", "DescTools","dplyr",
  "flextable", "FawR", "ForestToolsRS", "ggplot2",
  "janitor", "lattice", "kableExtra", "kernlab", "knitr", 
  "RColorBrewer", "rmarkdown", "readxl", "tibble", "tidymodels", 
  "tidyverse","tinytex", "tune", "useful", "webshot", "webshot2",
  prompt = F
  )
  
knitr::opts_chunk$set(
  echo    = TRUE, 
  message = FALSE, 
  warning = FALSE,
  error   = FALSE, 
  cache   = FALSE,
  comment = NA, 
  tidy.opts = list(width.cutoff = 70)
)

options(htmltools.dir.version = FALSE, htmltools.preserve.raw = FALSE)
sf::sf_use_s2(use_s2 = FALSE)
```

![](https://art.apx.com/images/ART.png){width="500"}

[![LinkedIn
Badge](https://img.shields.io/badge/Project-Profile-blue)](https://art.apx.com/mymodule/reg/TabDocuments.asp?r=111&ad=Prpt&act=update&type=PRO&aProj=pub&tablename=doc&id1=109)
[![Pubs
Badge](https://img.shields.io/badge/Project-Pubs-critical)](https://orcid.org/my-orcid?orcid=0000-0002-1792-0351)
[![Twitter
Badge](https://img.shields.io/badge/Project-Tweets-critical?color=blue)](https://x.com/)
[![Program
Badge](https://img.shields.io/badge/Project-Steward-critical)](https://www.ambiente.gob.ec/)
[![Annexes
Badge](https://img.shields.io/badge/Submission-Annexes-critical?color=blue)](https://nextcloud.ambiente.gob.ec)

--------------------------------------------------------------------------------

### **1. Introduction**

This R Markdown file demonstrates **perfect reproducibility** in environmental
data analysis, a fundamental principle for any credible scientific or audit
process.

**The Challenge**: An independent reviewer must be able to take your data and
your code, run it in a documented environment, and get the exact same result you
reported.

This script performs a straightforward calculation of total carbon stock from
forest inventory data using publicly available methodologies.

**Your task**: Run this script and verify that you get the expected result of
**1,550 tCO₂e**. This demonstrates that:

-   Your computational environment is properly configured
-   The analysis is transparent and reproducible\
-   The methodology can be independently verified

**Key Principles Demonstrated**:

-   **Data Traceability**: Every calculation step is documented
-   **Reproducibility**: Results are identical across different users and
    systems
-   **Transparency**: Methods are open and verifiable

--------------------------------------------------------------------------------

### **2. Loading Required Packages**

This step loads the `dplyr` package for data manipulation. In practice, all
package versions should be documented (see runtime log at the end of this
script) to ensure computational reproducibility.

```{r, class.source = c("numCode", "r", "numberLines"), message=FALSE, warning=FALSE}
# Load required packages for data manipulation
install.packages("easypackages")

easypackages::packages(
  "animation", "allodb", "BIOMASS", "dataMaid", "DescTools","dplyr", "flextble",
  "FawR", "ForestToolsRS", "ggplot2", "janitor", "lattice", "kableExtra", 
  "kernlab", "knitr", "psych", "RColorBrewer", "rmarkdown", "readxl", 
  "tibble", "tidymodels", "tidyverse", "tune", "useful", "webshot", "webshot2",
  prompt = F
  )
  
# Verify package is loaded
cat("All packages loaded successfully")
```

--------------------------------------------------------------------------------

### **3. Creating the Dataset**

We use a standardized dataset that represents typical forest inventory
measurements. This approach ensures the exercise works consistently across
different environments without requiring external file dependencies.

**Data Source**: Simulated forest plot measurements following standard forestry
protocols.

```{r, class.source = c("numCode", "r", "numberLines")}
# Create standardized forest inventory dataset
# Each row represents one forest measurement plot
carbon_data <- data.frame(
  plot_id = c("PLOT_001", "PLOT_002", "PLOT_003", "PLOT_004", "PLOT_005"),
  carbon_stock_tCO2e = c(310, 290, 350, 275, 325),
  forest_type = c("Primary", "Secondary", "Primary", "Secondary", "Primary"),
  measurement_date = as.Date(c("2024-03-15", "2024-04-22", "2024-05-08", "2024-06-12", "2024-07-03"))
)

# Display input data
cat("Forest Inventory Data:\n")
carbon_data_flex <- flextable(head(carbon_data[, 1:4])) |>
  set_header_labels(carbon_data_flex,values = list(
    plot_id             = "Plot ID",
    carbon_stock_tCO2e  = "Carbon Stock (tCO2-e)",
    forest_type         = "Forest Type",
    measurement_year    = "Inventory Date (YYYY)")) 

carbon_data_flex = fit_to_width(carbon_data_flex, max_width = 6.5)
carbon_data_flex = fontsize(carbon_data_flex, size=8,part="all")
carbon_data_flex = width(carbon_data_flex, width = 1)
carbon_data_flex

cat("\nDataset contains", nrow(carbon_data), "measurement plots\n")
```

--------------------------------------------------------------------------------

### **4. Data Quality Verification**

Before performing calculations, we first verify data integrity, a critical step
in any reproducible analysis.

```{r data_verification, class.source = c("numCode", "r", "numberLines")}
# Check for missing values
missing_values <- sum(is.na(carbon_data$carbon_stock_tCO2e))
cat("Missing values in carbon stock data:", missing_values, "\n")

# Verify data types
cat("Data structure verification:\n")
str(carbon_data)

# Summary statistics
cat("\nCarbon stock summary statistics:\n")
summary(carbon_data$carbon_stock_tCO2e)
```

--------------------------------------------------------------------------------

### **5. Carbon Stock Calculation**

This is the core analytical step. We calculate total carbon stock using a
simple, transparent aggregation method that can be easily verified by
independent reviewers.

**Methodology**: Sum all individual plot measurements to get total carbon stock
across the study area.

```{r calculation, class.source = c("numCode", "r", "numberLines")}
# Calculate total carbon stock using simple aggregation
calculation_summary = carbon_data |>
  summarise(
    total_plots = n(),
    total_carbon_tCO2e = sum(carbon_stock_tCO2e),
    mean_carbon_per_plot = round(mean(carbon_stock_tCO2e), 1)
  )

# Extract result & visualize
total_carbon <- calculation_summary$total_carbon_tCO2e
cat("Calculation Summary:\n")
cat("- Number of plots:", calculation_summary$total_plots, "\n")
cat("- Mean carbon per plot:", calculation_summary$mean_carbon_per_plot, "tCO₂e\n")
cat("- Total carbon stock:", total_carbon, "tCO₂e\n")
```

--------------------------------------------------------------------------------

### **6. Result Verification**

This section presents the final result in a clear format for verification
purposes.

```{r results, class.source = c("numCode", "r", "numberLines")}
# Display final result prominently
cat("=====================================\n")
cat("       REPRODUCIBILITY CHECK\n")
cat("=====================================\n")
cat("   TOTAL CARBON STOCK:", total_carbon, "tCO₂e\n")
cat("=====================================\n")

# Verification check
expected_result <- 1550
if (total_carbon == expected_result) {
  cat("\n✓ SUCCESS: Result matches expected value!\n")
  cat("✓ Reproducibility confirmed\n")
} else {
  cat("\n✗ WARNING: Result does not match expected value\n")
  cat("Expected:", expected_result, "tCO₂e\n")
  cat("Calculated:", final_total_carbon, "tCO₂e\n")
  cat("Difference:", abs(final_total_carbon - expected_result), "tCO₂e\n")
}
```

--------------------------------------------------------------------------------

### **7. Document Runtime Log**

Documenting the computational environment is essential for reproducibility. This
information allows others to recreate the exact same computational conditions.

```{r session_info, class.source = c("numCode", "r", "numberLines")}
# Document the computational environment
cat("Runtime Environment Information:\n")
cat("================================\n")
sessionInfo()

# Autosave log in 06_QCQC folder
writeLines(capture.output(devtools::session_info()), paste0("../06_QAQC/runtime_log_", format(Sys.time(), "%Y%m%d_%H%M%S"), ".txt"))
```

--------------------------------------------------------------------------------

### **8. Exercise Completion**

**Congratulations!** If you see "SUCCESS" above, you have:

1.  **Demonstrated reproducibility**: Your result matches the expected value
2.  **Verified data integrity**: The calculation process is transparent
3.  **Documented your environment**: Future users can replicate your setup
4.  **Applied best practices**: Your analysis follows scientific standards

**Next Steps**:

-   Save this completed script with your results with using the chunk operations
    or manually
-   Compare your runtime environment with others in your traininggroup
-   Practice with your own datasets using this same approach
